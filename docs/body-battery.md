# Body Battery（BB）目标定义（v0 / 可解释主干）

## 1. BB 是什么

**Body Battery（BB）** 在本方案中被定义为一个 **随时间变化、范围固定为 `[0,100]` 的“综合身体状态分数”**，并明确细化为三个可解释维度：

- **身体舒适度 `Comfort(t) ∈ [0,100]`**：热舒适/呼吸舒适等“当下体感”相关的指标（越高越舒适）
- **疲劳度 `Fatigue(t) ∈ [0,100]`**：由活动负荷、压力与异常信号驱动的“疲劳压力/疲劳水平”（越高越疲劳）
- **能力储备度 `Reserve(t) ∈ [0,100]`**：可用于训练与日常表现的“能力/能量储备”（越高越可用）

其中：

- 对外展示的主曲线仍以 **`Reserve(t)`（即传统意义的 BB）** 为核心（便于与 Garmin 类似产品语义对齐）
- `Comfort(t)` 与 `Fatigue(t)` 作为 **解释层与调制项**：解释“为什么同样睡够了但恢复差”“为什么体感差导致准备度下降”等现象

BB 的设计目标是把 Apple Health/Watch 的多源、稀疏、噪声信号，压缩成一个 **可解释、可稳定、可用于恢复管理与训练准备度** 的时序输出。

## 2. 必须同时满足的产品属性

### 2.1 可解释（Explainable）
BB 的输出与变化被拆解为两层：

**A. 状态维度（What / 当前状态）**

- `Reserve(t)`：能力储备度（主曲线）
- `Fatigue(t)`：疲劳度
- `Comfort(t)`：身体舒适度

**B. 动力学维度（Why / 为什么变化）**

- `Charge(t)`：充电/恢复贡献（睡眠、静息、正念放松等）
- `Drain(t)`：放电/消耗贡献（活动负荷、训练负荷、生理压力、异常信号等）
- `Confidence(t)`：置信度/数据质量（由缺失、噪声、与上下文匹配程度驱动）

要求 UI 或日志能回答“为什么今天 BB 低/高”，并能定位到：是睡眠结构差、压力高、训练负荷大，还是数据缺失导致不确定。

### 2.2 有约束（Physiologically Plausible）
BB 必须具备以下硬约束，避免“看起来像 bug”的行为：

- **有界**：`BB(t) ∈ [0,100]`
- **充电饱和**：当 BB 越接近 100，同等恢复输入的充电速度越慢（防止 95→100 秒级跳满）
- **变化率受限**：单位时间内 BB 变化不应出现不合理的大跳变（限制噪声放大）
- **上下文一致**：睡眠段总体更倾向于充电，训练段总体更倾向于放电（允许个别异常，如“病中睡眠也不恢复”）

### 2.3 个体化（Personalized）
同样的 HRV/体温/呼吸在不同人身上意义不同，因此 BB 的核心输出必须：

- 强依赖个人基线（`HRV_base, RHR_base, SpO2_base, RR_base, Temp_base`）
- 引入 **行为基线（例如最近 10 天的睡眠时长/训练强度分布）**：动作先过基线判断是否“对该用户来说异常”，若异常则动态缩放该动作对 `Charge/Drain` 的影响幅度
- 在缺失信号时仍能稳定输出（依赖质量分/门控降权，而不是报错或剧烈漂移）

### 2.4 可进化（Upgradeable）
BB 主干要先“像 Garmin 一样”可解释稳定；随后允许引入学习型模块做改进：

- **主干（Mechanistic Core）**：保证约束与可解释
- **学习型增强（DL / Residual）**：学习复杂非线性、动态权重、个体校准，但必须在主干约束内工作

## 3. 腕温（WST）对 BB 的影响：必须“分机制”建模

Apple Watch 的睡眠腕温属于 **外周皮肤温度（wrist skin temperature, WST）**，并不等同核心体温；因此温度影响必须以 **“相对个人基线的偏移 + 时间结构 + 共现信号”** 来解释，而不能依赖绝对阈值。

在实现层面将温度影响拆成两条相反机制，并用可观测信号做判别：

- **机制 A：入睡期外周散热信号（可能有益）**
  - 特征：入睡前后短窗口（例如前 60 分钟）出现**温和的 WST 升高**，且不存在明显“热负荷”共现信号
  - 作用：提高 `Charge(t)` 的睡眠恢复效率（同样睡眠阶段，恢复更有效）
- **机制 B：整夜热负荷/散热受限（往往有害）**
  - 特征：WST **持续偏高**（超过入睡窗口仍高），并与以下至少部分共现：RR 升高、SpO₂ 下降、睡眠结构碎片化（更多清醒/在床）、夜间 HR 偏高或 HRV 下降
  - 作用：降低 `Charge(t)`（恢复打折）并提高 `Drain(t)`（异常/压力消耗），同时降低 `Comfort(t)`

备注：炎症/发热相关的温度升高在 WST 上可能出现，但单靠 WST 不能做医学判断；仅在“温度显著偏高 + HR 偏高/HRV 下降/RR 升高”等共现时，作为“恢复惩罚/舒适度下降”的信号纳入。

## 4. 平静恢复算法（运动后短暂回升）

为满足“活动结束后仍可能出现短暂恢复回升”的生理现象，本方案新增 **平静恢复（post-activity calm recovery）**：

- 触发条件（需要满足“活动刚结束 + 恢复特征出现”）：
  - **活动结束**：从 `WORKOUT/ACTIVE/LIGHT_ACTIVITY` 进入低活动 epoch，并处于恢复窗口（例如 90 分钟内）
  - **恢复特征**：心率下降（HR drop）、HRV 上升（若可得）、以及能量/步数消耗下降（kcal/steps drop）
- 输出行为（受限、短暂、小幅度）：
  - 在满足条件的短窗口内，为 `Reserve(BB)` 增加一个小的额外充电项（保证“可回升但不跳变”）
  - 同时对 HR 导致的“压力放电”做抑制（避免把运动后正常的高心率误判为心理压力）

该算法本质是一个 **可解释的启发式门控**：只有当“活动后恢复信号”足够明确且持续时间有限时才生效；信号缺失或矛盾（例如 HR 不降、热负荷明显、数据质量低）则自动失效。

## 5. BB 的系统化输出（面向产品与研究）

### 5.1 时序输出
每个 epoch（推荐 1–5 分钟）输出：

- `Reserve(t)`（主曲线 / 传统 BB）、`Comfort(t)`、`Fatigue(t)`
- `Charge(t)`、`Drain(t)`、`Confidence(t)`
- `Context(t)`：睡眠/训练/冥想/清醒静息/日常活动/运动后平静恢复（`POST_ACTIVITY_RECOVERY`）等

### 5.2 日级衍生指标（示例）

- 晨起电量：主要睡眠结束时的 BB
- 睡眠充电量：主要睡眠期间 BB 的净增加
- 日内消耗曲线：白天 BB 下降的轨迹与峰值耗电段
- 训练准备度（readiness）：基于晨起 BB + 近期负荷/压力的组合指标（可先给规则版本，后续学习个体化）

## 6. 免责声明（必须）
BB 属于“健康洞察/恢复管理”指标，不是医疗诊断；尤其基于 SpO₂、体温等信号时，输出不得推导疾病结论，仅提示“异常信号可能影响恢复”与“数据不足/佩戴不稳定”。
