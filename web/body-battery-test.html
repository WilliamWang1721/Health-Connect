<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Body Battery Sandbox (Reserve/Comfort/Fatigue v0.2)</title>
    <style>
      :root {
        --bg: #0b1220;
        --card: #111a2d;
        --border: #243252;
        --text: #e8eefc;
        --muted: #9db0da;
        --accent: #7aa2ff;
        --danger: #ff6b6b;
        --good: #3ddc97;
        --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New",
          monospace;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji",
          "Segoe UI Emoji";
        background: radial-gradient(1200px 800px at 20% 0%, #17264d 0%, var(--bg) 55%);
        color: var(--text);
      }

      header {
        padding: 22px 18px 12px;
        max-width: 100%;
        margin: 0 auto;
      }

      header h1 {
        margin: 0 0 6px;
        font-size: 20px;
        font-weight: 700;
        letter-spacing: 0.2px;
      }

      header p {
        margin: 0;
        color: var(--muted);
        line-height: 1.5;
        font-size: 13px;
      }

      .wrap {
        max-width: 100%;
        margin: 0 auto;
        padding: 12px 18px 32px;
        display: grid;
        grid-template-columns: 1fr;
        gap: 14px;
      }

      @media (min-width: 960px) {
        .wrap {
          grid-template-columns: 420px 1fr;
          align-items: start;
        }
      }

      .card {
        background: linear-gradient(180deg, rgba(255, 255, 255, 0.035), rgba(255, 255, 255, 0.015));
        border: 1px solid var(--border);
        border-radius: 14px;
        padding: 14px;
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.25);
      }

      .card h2 {
        margin: 0 0 10px;
        font-size: 14px;
        color: #cfe0ff;
      }

      .row {
        display: grid;
        gap: 10px;
      }

      .row.two {
        grid-template-columns: 1fr 1fr;
      }

      label {
        display: grid;
        gap: 6px;
        font-size: 12px;
        color: var(--muted);
      }

      label.checkbox {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      label.checkbox input[type="checkbox"] {
        width: auto;
        padding: 0;
        margin: 0;
      }

      input,
      select,
      textarea {
        width: 100%;
        border-radius: 10px;
        border: 1px solid var(--border);
        background: rgba(10, 16, 30, 0.65);
        color: var(--text);
        padding: 9px 10px;
        font-size: 13px;
        outline: none;
      }

      textarea {
        min-height: 140px;
        resize: vertical;
        font-family: var(--mono);
        line-height: 1.4;
      }

      input:focus,
      select:focus,
      textarea:focus {
        border-color: rgba(122, 162, 255, 0.75);
        box-shadow: 0 0 0 3px rgba(122, 162, 255, 0.15);
      }

      details {
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 10px;
        margin-top: 10px;
        background: rgba(10, 16, 30, 0.35);
      }

      details summary {
        cursor: pointer;
        color: #cfe0ff;
        font-size: 12px;
      }

      .actions {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 12px;
      }

      button {
        border: 1px solid var(--border);
        background: rgba(122, 162, 255, 0.12);
        color: var(--text);
        border-radius: 10px;
        padding: 9px 10px;
        font-size: 13px;
        cursor: pointer;
      }

      button.primary {
        background: rgba(122, 162, 255, 0.22);
        border-color: rgba(122, 162, 255, 0.55);
      }

      button.danger {
        background: rgba(255, 107, 107, 0.14);
        border-color: rgba(255, 107, 107, 0.55);
      }

      button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }

      .tabs {
        display: inline-flex;
        gap: 6px;
        margin-bottom: 10px;
      }

      .tab {
        padding: 8px 10px;
        font-size: 12px;
      }

      .tab.active {
        border-color: rgba(122, 162, 255, 0.55);
        background: rgba(122, 162, 255, 0.22);
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      th,
      td {
        border-bottom: 1px solid rgba(36, 50, 82, 0.7);
        padding: 8px 6px;
        font-size: 12px;
        color: var(--text);
        text-align: left;
        vertical-align: top;
      }

      th {
        position: sticky;
        top: 0;
        background: rgba(10, 16, 30, 0.85);
        color: #cfe0ff;
        z-index: 1;
      }

      .kv-table td.k {
        font-family: var(--mono);
        color: #cfe0ff;
        width: 38%;
      }

      .kv-table td.v {
        font-family: var(--mono);
        width: 62%;
      }

      .scroll {
        max-height: min(60vh, 620px);
        overflow: auto;
        border: 1px solid var(--border);
        border-radius: 12px;
      }

      .pill {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 5px 8px;
        border-radius: 999px;
        border: 1px solid var(--border);
        background: rgba(10, 16, 30, 0.55);
        font-size: 12px;
        color: var(--muted);
      }

      .pill strong {
        color: var(--text);
      }

      #chart {
        width: 100%;
        height: 340px;
        border: 1px solid var(--border);
        border-radius: 12px;
        background: rgba(10, 16, 30, 0.35);
        cursor: crosshair;
        touch-action: none;
      }

      .chart-wrap {
        position: relative;
      }

      .chart-toolbar {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        align-items: center;
        justify-content: space-between;
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 10px;
        background: rgba(10, 16, 30, 0.35);
      }

      .chart-toolbar-group {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        align-items: center;
      }

      .chart-toolbar label {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .chart-toolbar label.checkbox {
        font-size: 12px;
        color: var(--muted);
      }

      .chart-toolbar select {
        width: auto;
        min-width: 200px;
        padding: 7px 10px;
        font-size: 12px;
      }

      .chart-toolbar button {
        padding: 7px 10px;
        font-size: 12px;
      }

      .chart-tooltip {
        position: absolute;
        z-index: 10;
        pointer-events: none;
        min-width: 210px;
        max-width: min(340px, calc(100vw - 32px));
        border: 1px solid rgba(36, 50, 82, 0.95);
        background: rgba(10, 16, 30, 0.92);
        border-radius: 12px;
        padding: 10px 10px 9px;
        box-shadow: 0 18px 40px rgba(0, 0, 0, 0.45);
        font-size: 12px;
        color: var(--text);
        backdrop-filter: blur(8px);
      }

      .chart-tooltip .tt-title {
        font-size: 12px;
        color: #cfe0ff;
        margin-bottom: 6px;
      }

      .chart-tooltip .tt-meta {
        color: var(--muted);
        font-size: 11px;
        margin-bottom: 8px;
      }

      .chart-tooltip .tt-grid {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 6px 10px;
        font-family: var(--mono);
        font-size: 11px;
        line-height: 1.25;
      }

      .chart-tooltip .tt-k {
        color: rgba(157, 176, 218, 0.95);
        white-space: nowrap;
      }

      .chart-tooltip .tt-v {
        color: var(--text);
        text-align: right;
        white-space: nowrap;
      }

      .error {
        color: var(--danger);
        font-size: 12px;
        margin-top: 8px;
        white-space: pre-wrap;
      }

      .hint {
        color: var(--muted);
        font-size: 12px;
      }

      .progress {
        width: 100%;
        height: 10px;
        border-radius: 999px;
        border: 1px solid var(--border);
        background: rgba(10, 16, 30, 0.35);
        overflow: hidden;
      }

      .progress > div {
        height: 100%;
        width: 0%;
        background: linear-gradient(90deg, rgba(122, 162, 255, 0.35), rgba(122, 162, 255, 0.9));
        transition: width 0.15s linear;
      }

      .modal {
        position: fixed;
        inset: 0;
        padding: 18px;
        z-index: 60;
      }

      .modal[hidden] {
        display: none;
      }

      .modal:not([hidden]) {
        display: grid;
        place-items: center;
      }

      .modal-backdrop {
        position: absolute;
        inset: 0;
        background: rgba(0, 0, 0, 0.65);
      }

      .modal-panel {
        position: relative;
        width: min(820px, 100%);
        border-radius: 14px;
        border: 1px solid var(--border);
        background: linear-gradient(180deg, rgba(17, 26, 45, 0.98), rgba(10, 16, 30, 0.96));
        box-shadow: 0 18px 60px rgba(0, 0, 0, 0.55);
        padding: 14px;
      }

      .modal-panel h2 {
        margin: 0 0 6px;
        font-size: 14px;
        color: #cfe0ff;
      }

      .modal-panel ul {
        margin: 10px 0 0 18px;
        padding: 0;
        line-height: 1.6;
        font-size: 13px;
      }

      .modal-panel li {
        margin: 7px 0;
        color: var(--muted);
      }

      #thanks {
        position: fixed;
        left: 12px;
        bottom: 12px;
        z-index: 20;
        padding: 6px 10px;
        border-radius: 999px;
        border: 1px solid var(--border);
        background: rgba(10, 16, 30, 0.55);
        color: var(--muted);
        font-size: 12px;
        line-height: 1;
        pointer-events: none;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Body Battery Sandbox (Reserve / Comfort / Fatigue v0.2)</h1>
      <p>
        Offline sandbox: input simulated data (or paste JSON) to estimate the Reserve(BB) curve, Comfort/Fatigue, and
        Charge/Drain/Confidence. Output is for wellness insight only, not medical diagnosis.
      </p>
    </header>

    <div id="upgradeModal" class="modal" hidden>
      <div class="modal-backdrop" id="upgradeBackdrop"></div>
      <div class="modal-panel" role="dialog" aria-modal="true" aria-labelledby="upgradeTitle">
        <h2 id="upgradeTitle">Update Notes</h2>
        <p class="hint" id="upgradeVersion"></p>
        <ul>
          <li>Three-kernel mode (Core + Neural trend + Hybrid blend)</li>
          <li>Optional forecast extension (experimental; Reserve only)</li>
          <li>Tooltip shows Core/Trend vs Hybrid output</li>
        </ul>
        <div class="actions">
          <button id="upgradeModalClose" class="primary">Got it</button>
        </div>
      </div>
    </div>

    <div id="thanks">Credits: Xiaohongshu @是江尾呀QAQ</div>

    <div class="wrap">
      <section class="card" id="left">
        <h2>Parameters & Baselines</h2>
        <div class="row two">
          <label>Epoch (minutes)<input id="epochMinutes" type="number" min="1" step="1" value="5" /></label>
          <label>Initial Reserve(BB) (0-100)<input id="initialBB" type="number" min="0" max="100" step="1" value="70" /></label>
        </div>

        <details open>
          <summary>Personal baselines (optional; inferred from input + defaults if empty)</summary>
          <div class="row two" style="margin-top: 10px">
            <label>RHR_base (bpm)<input id="rhrBpm" type="number" step="0.1" placeholder="e.g. 58" /></label>
            <label>HRV_base (SDNN, ms)<input id="hrvSdnnMs" type="number" step="0.1" placeholder="e.g. 55" /></label>
            <label>SpO2_base (%)<input id="spo2Pct" type="number" step="0.1" placeholder="e.g. 97" /></label>
            <label>RR_base (brpm)<input id="respRateBrpm" type="number" step="0.1" placeholder="e.g. 14" /></label>
            <label>Temp_base (C)<input id="wristTempC" type="number" step="0.01" placeholder="e.g. 36.5" /></label>
            <label>FTP (W, optional)<input id="ftpW" type="number" step="1" placeholder="e.g. 220" /></label>
            <label>HR_max (bpm, optional)<input id="hrMaxBpm" type="number" step="1" placeholder="e.g. 190" /></label>
          </div>
        </details>

        <details>
          <summary>Behavior baseline (10-day personalization, optional)</summary>
          <div class="row two" style="margin-top: 10px">
            <label class="checkbox"><input id="behaviorBaselineEnabled" type="checkbox" />Enable behavior baseline</label>
            <label>Baseline days<input id="behaviorBaselineDays" type="number" min="1" step="1" value="10" /></label>
          </div>
          <p class="hint" style="margin-top: 8px">
            The model builds a personal baseline from the first N days of sleep/workout behavior, then from day N+1
            scales recovery/drain for unusual behaviors (e.g. sleep duration outside generic health ranges but within
            your personal baseline will not be discounted).
          </p>
        </details>

        <details>
          <summary>Three-kernel mode (Core + Neural trend, experimental)</summary>
          <div class="row two" style="margin-top: 10px">
            <label class="checkbox"><input id="threeKernelEnabled" type="checkbox" />Enable three-kernel mode</label>
            <label>Forecast hours<input id="threeKernelForecastHours" type="number" min="0" step="1" value="0" /></label>
          </div>
          <div class="row two" style="margin-top: 10px">
            <label>Core weight<input id="threeKernelWeightCore" type="number" min="0" max="1" step="0.01" value="0.9" /></label>
            <label>Trend weight<input id="threeKernelWeightTrend" type="number" min="0" max="1" step="0.01" value="0.1" /></label>
          </div>
          <p class="hint" style="margin-top: 8px">
            Core = current rule-based model. Trend = tiny neural forecast trained on prior BB deltas. Hybrid = weighted
            blend (weights are normalized).
          </p>
        </details>

		        <details>
		          <summary>Advanced parameters (optional)</summary>
		          <div class="row two" style="margin-top: 10px">
		            <label>Sleep charge baseline (BB/h)<input id="baseSleepChargePerHour" type="number" step="0.1" placeholder="default 10.5" /></label>
		            <label>Sleep duration weight<input id="sleepChargeDurationWeight" type="number" step="0.01" placeholder="default 0.8" /></label>
		            <label>Sleep quality exponent<input id="sleepRecoveryExponent" type="number" step="0.05" placeholder="default 1.6" /></label>
		            <label>Rest charge baseline (BB/h)<input id="baseRestChargePerHour" type="number" step="0.1" placeholder="default 2" /></label>
		            <label>Mind charge baseline (BB/h)<input id="baseMindChargePerHour" type="number" step="0.1" placeholder="default 4" /></label>
		            <label>Workout max drain (BB/h)<input id="loadDrainWorkoutMaxPerHour" type="number" step="0.1" placeholder="default 35" /></label>
		            <label>Workout HR weight<input id="workoutHrWeight" type="number" step="0.01" placeholder="default 1.2" /></label>
		            <label>Daily max drain (BB/h)<input id="loadDrainActiveMaxPerHour" type="number" step="0.1" placeholder="default 18" /></label>
		          </div>
          <div class="row two" style="margin-top: 10px">
            <label>High activity max drain (BB/h)<input id="loadDrainHighMaxPerHour" type="number" step="0.1" placeholder="default 26" /></label>
            <label>Light max drain (BB/h)<input id="loadDrainLightMaxPerHour" type="number" step="0.1" placeholder="default 12" /></label>
            <label>Inactive max drain (BB/h)<input id="loadDrainInactiveMaxPerHour" type="number" step="0.1" placeholder="default 6" /></label>
            <label>State light min (0-1)<input id="stateLightMin01" type="number" step="0.01" placeholder="default 0.15" /></label>
            <label>State active min (0-1)<input id="stateActiveMin01" type="number" step="0.01" placeholder="default 0.4" /></label>
            <label>State high min (0-1)<input id="stateHighMin01" type="number" step="0.01" placeholder="default 0.7" /></label>
            <label>Rest charge min potential (0-1)<input id="restChargeMinPotential01" type="number" step="0.01" placeholder="default 0.2" /></label>
            <label>Rest charge stress max (0-5)<input id="restChargeStressIndexMax" type="number" step="0.1" placeholder="default 1.8" /></label>
            <label>Rest charge anom max<input id="restChargeAnomIndexMax" type="number" step="0.1" placeholder="default 1.2" /></label>
            <label>Rest charge gain exponent<input id="restChargeGainExponent" type="number" step="0.01" placeholder="default 1.25" /></label>
          </div>
          <div class="row two" style="margin-top: 10px">
            <label>Sleep onset window (min)<input id="tempOnsetWindowMinutes" type="number" step="1" placeholder="default 60" /></label>
            <label>Sleep-onset temp rise cap (C)<input id="tempOnsetBeneficialMaxC" type="number" step="0.01" placeholder="default 0.45" /></label>
            <label>Overheat threshold (C)<input id="tempOverheatStartC" type="number" step="0.01" placeholder="default 0.35" /></label>
            <label>Fever-like threshold (C)<input id="tempFeverStartC" type="number" step="0.01" placeholder="default 0.9" /></label>
            <label>Temp anomaly weight<input id="tempAnomWeight" type="number" step="0.05" placeholder="default 0.9" /></label>
            <label>Comfort penalty / index<input id="comfortPenaltyPerIndex" type="number" step="1" placeholder="default 12" /></label>
            <label>Fatigue=100 drain per hour<input id="fatigueDrainPerHourFor100" type="number" step="1" placeholder="default 40" /></label>
          </div>
          <div class="row two" style="margin-top: 10px">
            <label>Recovery window (min)<input id="postActivityRecoveryWindowMinutes" type="number" step="1" placeholder="default 90" /></label>
            <label>Max recovery duration (min)<input id="postActivityRecoveryMaxMinutes" type="number" step="1" placeholder="default 45" /></label>
            <label>CalmRec max charge (BB/h)<input id="postActivityRecoveryChargeMaxPerHour" type="number" step="0.1" placeholder="default 4" /></label>
            <label>Stress suppression power<input id="postActivityRecoveryStressSuppressionPower" type="number" step="1" placeholder="default 2" /></label>
            <label>Stress suppression min factor<input id="postActivityRecoveryStressSuppressionMinFactor" type="number" step="0.01" placeholder="default 0.08" /></label>
            <label>Max movement intensity in recovery (0-1)<input id="postActivityRecoveryMaxMovementIntensity01" type="number" step="0.01" placeholder="default 0.15" /></label>
          </div>
        </details>
      </section>

      <section class="card" id="right">
        <h2>Input & Output</h2>

        <div class="tabs">
          <button class="tab active" data-tab="segments" id="tabBtnSegments">Segment Input</button>
          <button class="tab" data-tab="json" id="tabBtnJson">JSON Input</button>
          <button class="tab" data-tab="apple" id="tabBtnApple">Apple Health Import</button>
        </div>

        <div id="tabSegments">
          <div class="row two">
            <label>Start time (local)<input id="startTime" type="datetime-local" /></label>
            <label class="hint">Tip: use Segment Input to quickly build sleep/workout/daily blocks; leave empty to use now.</label>
          </div>

          <div class="actions">
            <button id="addSegment">Add Segment</button>
            <button id="loadSample" class="primary">Load Sample</button>
            <button id="clearSegments" class="danger">Clear</button>
            <button id="runSegments" class="primary">Compute BB</button>
          </div>

          <div class="scroll" style="margin-top: 10px">
            <table id="segmentsTable">
              <thead>
                <tr>
                  <th style="min-width: 140px">Type</th>
                  <th style="min-width: 80px">Duration (min)</th>
                  <th style="min-width: 70px">HR</th>
                  <th style="min-width: 80px">HRV (ms)</th>
                  <th style="min-width: 90px">Steps/min</th>
                  <th style="min-width: 110px">Energy (kcal/min)</th>
                  <th style="min-width: 70px">Power (W)</th>
                  <th style="min-width: 70px">SpO2 (%)</th>
                  <th style="min-width: 70px">RR</th>
                  <th style="min-width: 90px">Wrist Temp (C)</th>
                  <th style="min-width: 70px">Actions</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>

          <div class="error" id="segmentsError" hidden></div>
        </div>

        <div id="tabJson" hidden>
          <p class="hint">
            JSON format: <span style="font-family: var(--mono)">{"epochMinutes":5,"initialBB":70,"baselines":{...},"epochs":[...]}</span>
          </p>
          <textarea id="jsonInput" spellcheck="false"></textarea>
          <div class="actions">
            <button id="loadSampleJson">Load Sample JSON</button>
            <button id="runJson" class="primary">Compute BB</button>
          </div>
          <div class="error" id="jsonError" hidden></div>
        </div>

        <div id="tabApple" hidden>
          <p class="hint">
            Supports Apple Health <span style="font-family: var(--mono)">export.xml</span> and HealthExportCSV
            <span style="font-family: var(--mono)">.csv</span> exports (select multiple CSV files). If you downloaded a
            <span style="font-family: var(--mono)">.zip</span>, unzip it first.
          </p>

          <div class="row">
            <label>Choose file(s) (export.xml / HealthExportCSV *.csv)
              <input id="appleHealthFile" type="file" multiple accept=".xml,.csv,.zip,application/zip,text/xml,application/xml,text/csv" />
            </label>
          </div>

          <div class="row two" style="margin-top: 10px">
            <label>Start time (local)<input id="appleStartTime" type="datetime-local" /></label>
            <label>End time (local)<input id="appleEndTime" type="datetime-local" /></label>
          </div>

          <div class="row two" style="margin-top: 10px">
            <label style="display: flex; gap: 8px; align-items: center">
              <input id="appleIncludeWorkouts" type="checkbox" checked />
              <span>Mark workout intervals</span>
            </label>
            <label style="display: flex; gap: 8px; align-items: center">
              <input id="appleIncludeMindful" type="checkbox" checked />
              <span>Mark mindful sessions</span>
            </label>
          </div>

          <div class="actions">
            <button id="appleSetRange24h">Last 24h</button>
            <button id="appleSetRange7d">Last 7d</button>
            <button id="appleImportToJson">Import to JSON</button>
            <button id="appleImportAndRun" class="primary">Import & Compute BB</button>
          </div>

          <div style="margin-top: 10px">
            <div class="progress" id="appleProgress" aria-label="Parsing progress" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
              <div id="appleProgressBar"></div>
            </div>
          </div>

          <div class="hint" id="appleStatus" style="margin-top: 8px"></div>
          <div class="error" id="appleError" hidden></div>
        </div>

        <hr style="border: 0; border-top: 1px solid rgba(36, 50, 82, 0.8); margin: 14px 0" />

        <div class="row">
          <div id="summaryBar" style="display: flex; flex-wrap: wrap; gap: 8px"></div>
          <details open>
            <summary>Computed baselines (model uses)</summary>
            <div class="scroll" style="margin-top: 10px; max-height: 220px">
              <table id="baselinesTable" class="kv-table">
                <thead>
                  <tr>
                    <th>Key</th>
                    <th>Value</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
            <div class="actions" style="margin-top: 10px">
              <button id="copyBaselinesJson">Copy baselines JSON</button>
            </div>
          </details>
          <details>
            <summary>Behavior baseline (behaviorBaseline)</summary>
            <div class="hint" id="behaviorBaselineHint" style="margin-top: 8px"></div>
            <textarea id="behaviorBaselineJson" spellcheck="false" readonly></textarea>
          </details>
          <div class="chart-toolbar" aria-label="Chart controls">
            <div class="chart-toolbar-group">
              <label class="checkbox"><input id="chartShowReserve" type="checkbox" checked />Reserve</label>
              <label class="checkbox"><input id="chartShowComfort" type="checkbox" checked />Comfort</label>
              <label class="checkbox"><input id="chartShowFatigue" type="checkbox" />Fatigue</label>
            </div>
            <div class="chart-toolbar-group">
              <label>Bottom metric
                <select id="chartBottomMetric">
                  <option value="chargeDrain" selected>Charge/Drain (per hour)</option>
                  <option value="confidence">Confidence</option>
                  <option value="hr">Heart rate (bpm)</option>
                  <option value="steps">Steps/min</option>
                  <option value="power">Power (W)</option>
                </select>
              </label>
              <label class="checkbox"><input id="chartShowSleep" type="checkbox" checked />Sleep</label>
              <label class="checkbox"><input id="chartShowEvents" type="checkbox" checked />Events</label>
              <button id="chartResetZoom">Reset zoom</button>
            </div>
          </div>
          <div class="chart-wrap" id="chartWrap">
            <canvas id="chart" width="980" height="340"></canvas>
            <div id="chartTooltip" class="chart-tooltip" hidden></div>
          </div>
          <div class="hint" id="chartHint">Hover to inspect · Drag to zoom · Double-click to reset</div>
          <details>
            <summary>Result table (first 250 rows)</summary>
            <div class="scroll" style="margin-top: 10px">
              <table id="resultTable">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Time</th>
                    <th>Context</th>
                    <th>BB</th>
                    <th>Comfort</th>
                    <th>Fatigue</th>
                    <th>Temp delta</th>
                    <th>TempMode</th>
                    <th>Delta</th>
                    <th>Charge</th>
                    <th>CalmRec</th>
                    <th>Drain</th>
                    <th>Conf</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </details>
          <details>
            <summary>Result JSON (export/replay)</summary>
            <textarea id="jsonOutput" spellcheck="false" readonly></textarea>
          </details>
        </div>
      </section>
    </div>

    <script src="../src/bodyBatteryModel.js" defer></script>
    <script src="./app.js" defer></script>
  </body>
</html>
